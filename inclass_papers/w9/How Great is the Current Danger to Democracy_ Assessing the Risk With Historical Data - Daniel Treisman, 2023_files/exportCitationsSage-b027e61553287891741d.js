(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{459:function(t,e,o){!function(t){var e={container:null,doi:"",citationStyle:"",selectors:{EXPORT_CITATIONS:".export-citations",CSL_DOI:'[name="csl-doi"]',CSL_STYLE:'[name="csl-style"]',CSL_RESPONSE:".csl-response",CITE_BUTTON:'[data-id="article-toolbar-cite"], [data-id="chapter-toolbar-cite"]'},SERVICE_SERVER:"",SERVICE_PATH:"/pb/widgets/citations",GET_META_DATA:"/getMetaData",READ_CSL_FILE:"/readCSLFile",itemIDs:[],citations:null,init:function init(){this.container=document.querySelector(this.selectors.EXPORT_CITATIONS),this.container&&e.control()},control:function control(){var t=this;document.body.addEventListener("collateralButtons.render",(function(){document.querySelectorAll(e.selectors.CITE_BUTTON).forEach((function(o){o.addEventListener("click",e.citeProcLoad.bind(t))}))}))},ajaxRequest:function ajaxRequest(t,e,o,c){var i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];return $.ajax({url:t,data:e,async:i,dataType:o}).success(c)},citeProcLoad:function citeProcLoad(){if(this.doi=this.container.querySelector(this.selectors.CSL_DOI).value,this.citationStyle=this.container.querySelector(this.selectors.CSL_STYLE).value,this.doi&&this.citationStyle){$(this.selectors.CSL_RESPONSE).html("<span>Loading ... </span>");var t={doi:this.doi},e="".concat(this.SERVICE_SERVER).concat(this.SERVICE_PATH).concat(this.GET_META_DATA),o=this.citeProcLoadSuccess;this.ajaxRequest(e,t,"json",o)}},citeProcLoadSuccess:function citeProcLoadSuccess(t,o,c){for(var i in e.citations=t,e.citations)e.itemIDs.push(i);e.getCSLProcessor(e.citationStyle)},getCSLProcessor:function getCSLProcessor(t){var o={targetFile:"custom-"+t},c="".concat(e.SERVICE_SERVER).concat(e.SERVICE_PATH).concat(e.READ_CSL_FILE),i=e.getCSLProcessorSuccess;e.ajaxRequest(c,o,"text",i)},getCSLProcessorSuccess:function getCSLProcessorSuccess(t,c,i){var n=t,s={retrieveLocale:function retrieveLocale(t){var o="".concat(e.SERVICE_SERVER).concat(e.SERVICE_PATH).concat(e.READ_CSL_FILE);return e.ajaxRequest(o,{targetFile:"locales-en-US"},"text",null,!1).responseText},retrieveItem:function retrieveItem(t){return e.citations[t]}};Promise.resolve().then(o.bind(null,27)).then((function(t){var o=new t.CSL.Engine(s,n);o.opt.development_extensions.wrap_url_and_doi=!0,o.updateItems(e.itemIDs);var c=o.makeBibliography();$(e.container).find(e.selectors.CSL_RESPONSE).html(c[1][0])})).catch((function(t){console.log(t.message)}))}};t.exportCitationsSage=e}(UX)}}]);
//# sourceMappingURL=exportCitationsSage-b027e61553287891741d.js.map